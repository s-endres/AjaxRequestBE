@model RequestApp.Models.Book

@{
    ViewBag.Title = "Create";
}
<style>
    .Error {
        border: solid 1px red;
    }
</style>



<h2>Create</h2>

<script>
    $(document).ready(function () {


        $vDTable = $('#dTable').DataTable({

            "order": [[1, 'asc']],
            responsive: true,
            "columnDefs": [
                {
                    "targets": [5, 6],
                    "visible": false,
                    "searchable": false

                },

                {
                    "targets": [0, 7],
                    "sortable": false
                }
            ]

        });  

        $("#btnSave").click(function () {

            if (validateMyForm()) {
                var ObjP = {
                    Title: $("#Title").val(),
                    Description: $("#Description").val(),
                    ImageURL: $("#ImageURL").val(),
                    Publisher: $("#Publisher").val(),
                    PublicationYear: $("#PublicationYear").val()
                };

                $.ajax({
                    type: "POST",
                    url: "http://localhost:61232/Books/AddNewBook",
                    data: JSON.stringify(ObjP),
                    dataType: "json",
                    contentType: 'application/json; charset=utf-8',
                    success: function (Data) {
                        if (Data) {
                            window.location.replace("http://localhost:61232/Books/");
                        } else {
                            pError();
                        }
                    },
                    error: function () {
                        pError();
                    }
                });
            }


        });

    });

    function pError() {
        if (!$("p[class='ErrorClass']").length) {
            $(".form-horizontal").append("<p class='ErrorClass' style='color: red;'>An error has occurred while loading the data </p>");
        }
    }

    function validateMyForm() {
        var flag = true;
        $("input[type='text']").each(function () {
            if ($(this).val().trim() == "") {
                SwapClass($(this).parent(), "has-success", "has-error");
                flag = false;
            } else {
                SwapClass($(this).parent(), "has-error", "has-success");
            }

        })

        $("input[type='number']").each(function () {
            console.log($(this).val());
            if ($(this).val().trim() == "" || $(this).val() <= 0) {
                SwapClass($(this).parent(), "has-success", "has-error");
                flag = false;
            } else {
                SwapClass($(this).parent(), "has-error", "has-success");
            }

        });
        return flag;
    }
    function SwapClass(ThisText, ClassR, ClassA) {
        $(ThisText).removeClass(ClassR);
        $(ThisText).addClass(ClassA);
    }

    function validateMyModalForm() {
        var flag = true;
        $("#myModalForm div input[type='text']").each(function () {
            if ($.trim(this.value) == "") {
                $(this).addClass("Error");
                flag = false;
            } else {
                $(this).removeClass("Error");
            }
        });
        return flag;
    }

    function add() {
        if (validateMyModalForm()) {
            $vDTable.row.add([
                "<span id='MoreInfoIcon' class='glyphicon glyphicon-plus-sign'></span>",
                $("#firstInput").val(),
                $("#secondInput").val(),
                $("#thirdInput").val(),
                $("#fourthInput").val(),
                $("#fifthInput").val(),
                $("#sixthInput").val(),
                "<span class='glyphicon glyphicon-trash'></span> <span> | </span> " +
                "<span class='glyphicon glyphicon-pencil' onclick='editMyRow(this)'></span>"
            ]).draw();

            $("#myModalForm div input[type='text']").val("");
            $("#btnClose").click();
        }
    }

</script>

@using (Html.BeginForm())
{
    @Html.AntiForgeryToken()

    <div class="form-horizontal">
        <h4>Book</h4>
        <hr />
        @Html.ValidationSummary(true, "", new { @class = "text-danger" })
        <div class="form-group">
            @Html.LabelFor(model => model.Title, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.EditorFor(model => model.Title, new { htmlAttributes = new { @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.Title, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(model => model.Description, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.EditorFor(model => model.Description, new { htmlAttributes = new { @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.Description, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(model => model.ImageUrl, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.EditorFor(model => model.ImageUrl, new { htmlAttributes = new { @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.ImageUrl, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(model => model.Publisher, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.EditorFor(model => model.Publisher, new { htmlAttributes = new { @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.Publisher, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(model => model.PublicationYear, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                <input type="number" id="PublicationYear" name="PublicationYear" class="form-control" />
                @Html.ValidationMessageFor(model => model.PublicationYear, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            <div class="col-md-offset-2 col-md-10">
                <input type="button" id="btnSave" value="Create" class="btn btn-default" />
            </div>
        </div>
    </div>

    <div class="col-md-12">
        <div class="panel panel-default">
            <div class="panel-heading">
                Authors |
                <span class="glyphicon glyphicon-folder-open" id="addRowGlyphicon" data-toggle="modal" data-target="#myModal">
                </span>
            </div>
            <div class="panel-body">
                <div>
                    <div id="dTable_wrapper" class="dataTables_wrapper form-inline dt-bootstrap no-footer">
                        <div class="row"><div class="col-sm-6"><div class="dataTables_length" id="dTable_length"><label>Show <select name="dTable_length" aria-controls="dTable" class="form-control input-sm"><option value="10">10</option><option value="25">25</option><option value="50">50</option><option value="100">100</option></select> entries</label></div></div><div class="col-sm-6"><div id="dTable_filter" class="dataTables_filter"><label>Search:<input type="search" class="form-control input-sm" placeholder="" aria-controls="dTable"></label></div></div></div><div class="row">
                            <div class="col-sm-12">
                                <table class="table dataTable no-footer" id="dTable" role="grid" aria-describedby="dTable_info">
                                    <thead>
                                        <tr role="row"><th class="sorting_disabled" rowspan="1" colspan="1" aria-label="Show More" style="width: 276px;">Show More</th><th class="sorting_asc" tabindex="0" aria-controls="dTable" rowspan="1" colspan="1" aria-sort="ascending" aria-label="First Input: activate to sort column descending" style="width: 260px;">First Input</th><th class="sorting" tabindex="0" aria-controls="dTable" rowspan="1" colspan="1" aria-label="Second Input: activate to sort column ascending" style="width: 316px;">Second Input</th><th class="sorting" tabindex="0" aria-controls="dTable" rowspan="1" colspan="1" aria-label="Third Input: activate to sort column ascending" style="width: 274px;">Third Input</th><th class="sorting" tabindex="0" aria-controls="dTable" rowspan="1" colspan="1" aria-label="Fourth Input: activate to sort column ascending" style="width: 300px;">Fourth Input</th><th class="sorting_disabled" rowspan="1" colspan="1" aria-label="Buttons" style="width: 216px;">Buttons</th></tr>
                                    </thead>
                                    <tbody>
                                        <tr class="odd"><td valign="top" colspan="6" class="dataTables_empty">No data available in table</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-sm-6">
                                <div class="dataTables_info" id="dTable_info" role="status" aria-live="polite">Showing 0 to 0 of 0 entries</div>
                            </div>
                            <div class="col-sm-6">
                                <div class="dataTables_paginate paging_simple_numbers" id="dTable_paginate">
                                    <ul class="pagination"><li class="paginate_button previous disabled" aria-controls="dTable" tabindex="0" id="dTable_previous"><a href="#">Previous</a></li><li class="paginate_button next disabled" aria-controls="dTable" tabindex="0" id="dTable_next"><a href="#">Next</a></li></ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="myModal">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="myModalHeadAdd">Add new Author</h4>
                    <h4 class="modal-title" id="myModalHeadEdit" style="display:none">Edit Row</h4>
                </div>
                <div id="myModalBody" class="modal-body">
                    <form id="myModalForm">
                        <div class="form-group">
                            <label for="recipient-name" class="control-label">First Name:</label>
                            <input type="text" class="form-control" id="firstInput">
                        </div>
                        <div class="form-group">
                            <label for="message-text" class="control-label">Second Name:</label>
                            <input type="text" class="form-control" id="secondInput">
                        </div>
                        <div class="form-group">
                            <label for="message-text" class="control-label">LastName:</label>
                            <input type="text" class="form-control" id="thirdInput">
                        </div>
                        <div class="form-group">
                            <label for="message-text" class="control-label">Surname:</label>
                            <input type="text" class="form-control" id="fourthInput">
                        </div>

                        <input type="text" class="form-control" style="display:none" id="hiddenInput">
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" id="btnClose" class="btn btn-default" data-dismiss="modal">Close</button>
                    <button type="button" id="btnAdd" class="btn btn-primary" onclick="add()">Add Author</button>
                    <button type="button" id="btnEdit" class="btn btn-primary" style="display:none">Edit</button>
                </div>
            </div>
        </div>
    </div>

}



<div>
    @Html.ActionLink("Back to List", "Index")
</div>

@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
}
